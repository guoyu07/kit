#!/bin/bash
#------------------------------------------------
# target: paths on bash environment
# author: junjiemars@gmail.com
#------------------------------------------------

PLATFORM=`uname -s 2>/dev/null`

is_uniq() {
  local paths=`echo $PATH | tr ':' '\n'`
  if `echo $paths | grep "^$1$" &>/dev/null`; then
    return 0
  else
    return 1
  fi
}

append_path() {
	if [ -z "$1" -o 0 -eq $(is_uniq "$1";echo $?) ]; then
		return 1
	else
		PATH="${PATH:+$PATH:}$1"
		return 0
	fi
}

#uniq_path() {
#  # note:need refined
#	local p=`echo "$1" | tr ':' '\n' | uniq`
#	p=`echo "$p" | tr '\n' ':' | sed -e 's_:$__g'`
#  PATH=$p
#}

set_bin_paths() {
  local paths=(
    '/usr/local/bin'
    '/usr/bin'
    '/bin'
    '/usr/sbin'
    '/sbin'
  )
  
  for d in "${paths[@]}"; do
    if [ -d "${d}" ]; then
      append_path ${d}
    fi
  done
}

to_posix_path() {
  echo "\\$1" | \
    sed -e 's#^\\\([a-zA-Z]\):\\#\\\l\1\\#' | \
    sed -e 's#\\#\/#g' 
}


set_bin_paths


# chain basis PREFIX/opt/run/{bin,sbin} paths
if [ -n "${OPT_RUN}" ]; then
	append_path "${OPT_RUN}/bin"
	append_path "${OPT_RUN}/sbin"
fi

# java home
case "${PLATFORM}" in
  MSYS_NT*)
    if [ -n "${JAVA_HOME}" ]; then
      java_path=$(to_posix_path "${JAVA_HOME}")
      append_path "${java_path}"
			append_path "${java_path}/bin"
    fi
    ;;
  *)
		if [ -n "${JAVA_HOME}" ]; then
			append_path "${JAVA_HOME}"
    	append_path "${JAVA_HOME}/bin"
		fi
    ;;
esac


#uniq_path "$PATH"


# other paths

