#!/bin/bash
#------------------------------------------------
# target: paths on bash environment
# author: junjiemars@gmail.com
#------------------------------------------------

PLATFORM=`uname -s 2>/dev/null`

set_bin_paths() {
  local paths=(
    '/usr/local/bin'
    '/usr/bin'
    '/bin'
    '/usr/sbin'
    '/sbin'
  )
  
  for d in ${paths[@]}; do
    if [ -d "${d}" ]; then
      PATH="${PATH:-}${PATH:+:}${d}"
    fi
  done

  export PATH="`echo -n "${PATH}" | \
    awk -v RS=':' -v ORS=':' '!a[$1]++' | \
    awk '!/^$/' | \
    sed -e 's_^:__' -e 's_:\.:$__' -e 's_::__' -e 's_:$__'`"
}

append_paths() {
  if [ -n "$1" ] && [ -d "$1" ]; then
    local in_path=`echo $PATH | \
                  tr ':' '\n' | \
                  grep "$1" &>/dev/null; echo $?`
    [ 0 -ne "${in_path}" ] && PATH="${PATH:-}${PATH:+:}$1"
  fi
}

to_posix_path() {
  echo "\\$1" | \
    sed -e 's#^\\\([a-zA-Z]\):\\#\\\l\1\\#' | \
    sed -e 's#\\#\/#g' 
}

# set bin paths
set_bin_paths

# chain basis PREFIX/opt/run/{bin,sbin} paths
[ -n "${OPT_RUN}" ] && append_paths "${OPT_RUN}/bin"
[ -n "${OPT_RUN}" ] && append_paths "${OPT_RUN}/sbin"

# java home
case "${PLATFORM}" in
  MSYS_NT*)
    if [ -n "${JAVA_HOME}" ]; then
      java_path=$(to_posix_path "${JAVA_HOME}")
      [ -n "${java_path}" ] && \
        append_paths "${java_path}" && \
        append_paths "${java_path}/bin"
    fi
    ;;
  *)
    append_paths "${JAVA_HOME}"
    append_paths "${JAVA_HOME}/bin"
    ;;
esac

# other paths

