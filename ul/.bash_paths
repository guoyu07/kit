#!/bin/bash
#------------------------------------------------
# target: paths on bash environment
# author: junjiemars@gmail.com
#------------------------------------------------

PLATFORM=`uname -s 2>/dev/null`

append_path() {
	if [ -z "$1" ]; then
		return 1
	else
		PATH="${PATH:+$PATH:}$1"
		return 0
	fi
}

uniq_paths() {
	PATH=`echo $PATH | tr ':' '\n' | uniq | tr '\n' ':'`
	PATH="`echo -n "${PATH}" | \
		awk -v RS=':' -v ORS=':' '!a[$1]++' | \
		awk '!/^$/' | \
		sed -e 's_^:__' -e 's_:\.:$__' -e 's_::__' -e 's_:$__'`"
}

set_bin_paths() {
  local paths=(
    '/usr/local/bin'
    '/usr/bin'
    '/bin'
    '/usr/sbin'
    '/sbin'
  )
  
  for d in ${paths[@]}; do
    if [ -d "${d}" ]; then
      append_path ${d}
    fi
  done
}

to_posix_path() {
  echo "\\$1" | \
    sed -e 's#^\\\([a-zA-Z]\):\\#\\\l\1\\#' | \
    sed -e 's#\\#\/#g' 
}


set_bin_paths


# chain basis PREFIX/opt/run/{bin,sbin} paths
if [ -n "${OPT_RUN}" ]; then
	append_path "${OPT_RUN}/bin"
	append_path "${OPT_RUN}/sbin"
fi

# java home
case "${PLATFORM}" in
  MSYS_NT*)
    if [ -n "${JAVA_HOME}" ]; then
      java_path=$(to_posix_path "${JAVA_HOME}")
      append_path "${java_path}"
			append_path "${java_path}/bin"
    fi
    ;;
  *)
		if [ -n "${JAVA_HOME}" ]; then
			append_path "${JAVA_HOME}"
    	append_path "${JAVA_HOME}/bin"
		fi
    ;;
esac


uniq_paths "$PATH"


# other paths

