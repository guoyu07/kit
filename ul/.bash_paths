#!/bin/bash
#------------------------------------------------
# target: paths on bash environment
# author: junjiemars@gmail.com
#------------------------------------------------

PLATFORM=`uname -s 2>/dev/null`

append_path() {
	local new="$1"
	local paths="${@:2}"
	echo "${paths:+$paths:}$new"
}

uniq_path() {
  local paths="$@"
	paths=`echo "$paths" | tr ':' '\n' | awk '!a[$0]++'`
	paths=`echo "$paths" | tr '\n' ':' | sed -e 's_:$__g'`
  echo "$paths"
}

set_bin_paths() {
  local paths=(
    '/usr/local/bin'
    '/usr/bin'
    '/bin'
    '/usr/sbin'
    '/sbin'
  )
  
  for d in "${paths[@]}"; do
    if [ -d "${d}" ]; then
      PATH="`append_path ${d} $PATH`"
    fi
  done
}

on_windows_nt() {
 case "$PLATFORM" in
   MSYS_NT*|MINGW*)
     return 0
     ;;
   *)
     return 1
     ;;
 esac
}

posix_path() {
  local p="$@"
  if [[ $p =~ ^[a-zA-Z]:[\/\\].*$ ]]; then
    echo "\\$p" | \
      sed -e 's#^\\\([a-zA-Z]\):\\#\\\1\\#' | \
      sed -e 's#\\#\/#g' | \
      sed -e 's# #\\ #g'
  else
    echo "$p"
  fi
}

set_bin_paths


# chain basis PREFIX/opt/run/{bin,sbin} paths
if [ -n "${OPT_RUN}" ]; then
	PATH="`append_path ${OPT_RUN}/bin ${PATH[@]}`"
	PATH="`append_path ${OPT_RUN}/sbin ${PATH[@]}`"
	LD_LIBRARY_PATH="`append_path ${OPT_RUN}/lib ${LD_LIBRARY_PATH[@]}`"
fi

# java home
if [ -n "${JAVA_HOME}" ]; then
  if `on_windows_nt`; then
    JAVA_HOME=$(posix_path "${JAVA_HOME}")
  fi
  PATH="`append_path \"${JAVA_HOME}\" $PATH`"
  PATH="`append_path \"${JAVA_HOME}/bin\" $PATH`"
fi


PATH="`uniq_path ${PATH[@]}`"
LD_LIBRARY_PATH="`uniq_path ${LD_LIBRARY_PATH[@]}`"

# other paths
