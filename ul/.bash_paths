#!/bin/bash
#------------------------------------------------
# target: paths on bash environment
# author: junjiemars@gmail.com
#------------------------------------------------

PLATFORM=`uname -s 2>/dev/null`

append_path() {
	local new="$1"
	local paths="$2"
	echo "${paths:+$paths:}$new"
}

uniq_path() {
	local paths=`echo "$1" | tr ':' '\n' | awk '!a[$0]++'`
	paths=`echo "$paths" | tr '\n' ':' | sed -e 's_:$__g'`
  echo "$paths"
}

set_bin_paths() {
  local paths=(
    '/usr/local/bin'
    '/usr/bin'
    '/bin'
    '/usr/sbin'
    '/sbin'
  )
  
  for d in "${paths[@]}"; do
    if [ -d "${d}" ]; then
      PATH="`append_path ${d} $PATH`"
    fi
  done
}

to_posix_path() {
  echo "\\$1" | \
    sed -e 's#^\\\([a-zA-Z]\):\\#\\\l\1\\#' | \
    sed -e 's#\\#\/#g' 
}


set_bin_paths


# chain basis PREFIX/opt/run/{bin,sbin} paths
if [ -n "${OPT_RUN}" ]; then
	PATH="`append_path ${OPT_RUN}/bin $PATH`"
	PATH="`append_path ${OPT_RUN}/sbin $PATH`"
	LD_LIBRARY_PATH="`append_path ${OPT_RUN}/lib $LD_LIBRARY_PATH`"
fi

# java home
case "${PLATFORM}" in
  MSYS_NT*|MINGW*)
    if [ -n "${JAVA_HOME}" ]; then
      java_path=$(to_posix_path "${JAVA_HOME}")
      PATH="`append_path ${java_path} $PATH`"
			PATH="`append_path ${java_path}/bin $PATH`"
    fi
    ;;
  *)
		if [ -n "${JAVA_HOME}" ]; then
			PATH="`append_path ${JAVA_HOME} $PATH`"
    	PATH="`append_path ${JAVA_HOME}/bin $PATH`"
		fi
    ;;
esac


PATH="`uniq_path $PATH`"
LD_LIBRARY_PATH="`uniq_path $LD_LIBRARY_PATH`"

# other paths
